"use strict";exports.id=501,exports.ids=[501],exports.modules={17790:(e,t,r)=>{r.d(t,{A:()=>g});var s=r(60687),a=r(43210),n=r(16189),i=r(63213),o=r(93959),l=r(50515),c=r(30922),u=r(64364),d=r(81836);function g({placeholder:e="Search restaurants, cuisines...",className:t="",isMobile:r=!1}){let g=(0,n.useRouter)(),{user:h}=(0,i.A)(),[f,m]=(0,a.useState)(""),[x,p]=(0,a.useState)([]),[y,w]=(0,a.useState)(!1),[b,j]=(0,a.useState)(!1),[N,v]=(0,a.useState)(-1),[k,A]=(0,a.useState)([]),[S]=(0,a.useState)(()=>`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`),C=(0,a.useRef)(null),$=(0,a.useRef)(null),E=(0,a.useRef)(null),F=(0,a.useCallback)(async e=>{if(!e||e.length<2){try{let e=await fetch("/api/search/suggestions");if(e.ok){let t=await e.json();if(t.success){let e=t.data.suggestions.map(e=>({text:e,type:"popular"}));p(e)}}}catch(e){console.error("Error fetching popular searches:",e)}return}j(!0);try{let t=await fetch(`/api/search/learn?type=suggestions&q=${encodeURIComponent(e)}${h?.id?`&userId=${h.id}`:""}`),r=[];if(t.ok){let e=await t.json();e.success&&e.data.suggestions.length>0&&(r=e.data.suggestions.map((t,r)=>({text:t,type:"learned",score:e.data.suggestions.length-r})))}if(0===r.length){let t=await fetch(`/api/search/suggestions?q=${encodeURIComponent(e)}`);if(t.ok){let e=await t.json();e.success&&(r=e.data.suggestions.map((t,r)=>({text:t,type:"intelligent",score:e.data.suggestions.length-r})))}}p(r)}catch(e){console.error("Error fetching suggestions:",e)}finally{j(!1)}},[h?.id]),I=(0,a.useCallback)(e=>{E.current&&clearTimeout(E.current),E.current=setTimeout(()=>{F(e)},300)},[F]),T=e=>{if(!e.trim())return;let t=[e,...k.filter(t=>t!==e)].slice(0,5);A(t),localStorage.setItem("tap2go_recent_searches",JSON.stringify(t))},q=async(e,t=0)=>{try{await fetch("/api/search/learn",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"track_search",query:e,results:t,userId:h?.id,sessionId:S})})}catch(e){console.error("Error tracking search:",e)}},_=async(e,t)=>{try{await fetch("/api/search/learn",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"track_click",query:f,clickedResult:e.text,position:t,userId:h?.id,sessionId:S})})}catch(e){console.error("Error tracking click:",e)}},P=e=>{e.trim()&&(T(e.trim()),q(e.trim()),w(!1),m(""),g.push(`/search?q=${encodeURIComponent(e.trim())}`))},z=(e,t)=>{_(e,t),P(e.text)},M=e=>{switch(e){case"popular":return(0,s.jsx)(o.A,{className:"h-4 w-4 text-orange-500"});case"recent":return(0,s.jsx)(l.A,{className:"h-4 w-4 text-gray-400"});case"intelligent":return(0,s.jsx)(c.A,{className:"h-4 w-4 text-blue-500"});case"learned":return(0,s.jsx)(u.A,{className:"h-4 w-4 text-purple-500"});default:return(0,s.jsx)(c.A,{className:"h-4 w-4 text-gray-400"})}};return(0,s.jsxs)("div",{className:`relative ${t}`,children:[(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),N>=0&&x[N]?P(x[N].text):P(f)},className:"relative",children:[(0,s.jsx)(c.A,{className:`absolute ${r?"left-4":"left-3"} top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400`}),(0,s.jsx)("input",{ref:C,type:"text",placeholder:e,value:f,onChange:e=>{let t=e.target.value;m(t),v(-1),t.length>=0?(w(!0),I(t)):(w(!1),p([]))},onFocus:()=>{w(!0),0===f.length&&F("")},onBlur:()=>{setTimeout(()=>{w(!1),v(-1)},200)},onKeyDown:e=>{if(y&&0!==x.length)switch(e.key){case"ArrowDown":e.preventDefault(),v(e=>e<x.length-1?e+1:e);break;case"ArrowUp":e.preventDefault(),v(e=>e>0?e-1:-1);break;case"Escape":w(!1),v(-1),C.current?.blur()}},className:`
            w-full ${r?"pl-12 pr-12 py-3 rounded-full":"pl-10 pr-10 py-2 rounded-lg"} 
            bg-white text-gray-700 placeholder-gray-500 border border-gray-300
            focus:outline-none focus:ring-2 focus:ring-white focus:border-transparent
            transition-all duration-200
            ${y&&x.length>0?"rounded-b-none border-b-0":""}
          `}),f&&(0,s.jsx)("button",{type:"button",onClick:()=>{m(""),w(!1),p([]),C.current?.focus()},className:`absolute ${r?"right-4":"right-3"} top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600`,children:(0,s.jsx)(d.A,{className:"h-5 w-5"})})]}),y&&x.length>0&&(0,s.jsxs)("div",{ref:$,className:"absolute top-full left-0 right-0 bg-white border border-gray-300 border-t-0 rounded-b-lg shadow-lg max-h-80 overflow-y-auto z-50",children:[0===f.length&&k.length>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"px-4 py-2 text-xs font-medium text-gray-500 bg-gray-50 border-b",children:"Recent Searches"}),k.slice(0,3).map((e,t)=>(0,s.jsxs)("button",{onClick:()=>P(e),className:"w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center space-x-3 border-b border-gray-100",children:[(0,s.jsx)(l.A,{className:"h-4 w-4 text-gray-400"}),(0,s.jsx)("span",{className:"text-gray-700",children:e})]},`recent-${t}`)),x.length>0&&(0,s.jsx)("div",{className:"px-4 py-2 text-xs font-medium text-gray-500 bg-gray-50 border-b",children:0===f.length?"Popular Searches":"Suggestions"})]}),x.map((e,t)=>(0,s.jsxs)("button",{onClick:()=>z(e,t),className:`
                w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center space-x-3
                ${N===t?"bg-orange-50 border-l-2 border-orange-500":""}
                ${t===x.length-1?"":"border-b border-gray-100"}
              `,children:[M(e.type),(0,s.jsx)("span",{className:"text-gray-700",children:e.text}),"learned"===e.type&&(0,s.jsx)("span",{className:"ml-auto text-xs text-purple-500 font-medium",children:"Smart"})]},t)),b&&(0,s.jsxs)("div",{className:"px-4 py-3 text-center text-gray-500",children:[(0,s.jsx)("div",{className:"animate-spin inline-block w-4 h-4 border-2 border-orange-500 border-t-transparent rounded-full"}),(0,s.jsx)("span",{className:"ml-2",children:"Loading suggestions..."})]})]})]})}},23762:(e,t,r)=>{r.d(t,{A:()=>w});var s=r(60687);r(43210);var a=r(85814),n=r.n(a),i=r(16189),o=r(41350),l=r(28253),c=r(20816),u=r(65879),d=r(79857),g=r(30922),h=r(64908),f=r(71155),m=r(65960),x=r(24866),p=r(83535),y=r(66499);function w(){let e=(0,i.usePathname)(),{user:t,shouldWaitForAuth:r}=(0,o._)(),{cart:a}=(0,l._)();if(!e||e.startsWith("/admin")||e.startsWith("/vendor/")||"/vendor"===e||e.startsWith("/driver/")||"/driver"===e||e.startsWith("/auth")||e.startsWith("/test-")||t&&"customer"!==t.role&&"admin"!==t.role)return null;let w=r=>"/home"===r?"/home"===e||"/"===e||e.startsWith("/restaurant/")&&!e.startsWith("/restaurants"):"/restaurants"===r?"/restaurants"===e:"/search"===r?"/search"===e:"/profile"===r?"/account"===e||"/profile"===e||"/orders"===e||!t&&"/auth/signin"===e:"/cart"===r?"/cart"===e:e.startsWith(r),b=a?.items.reduce((e,t)=>e+t.quantity,0)||0;return(0,s.jsx)("nav",{className:"md:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-50",children:(0,s.jsxs)("div",{className:"grid grid-cols-5 h-14 relative",children:[(0,s.jsxs)(n(),{href:"/home",className:`flex flex-col items-center justify-center space-y-0.5 transition-colors ${(w("/home"),"text-gray-500 hover:text-gray-700")}`,children:[w("/home")?(0,s.jsx)(f.A,{className:"h-5 w-5",style:{color:"#f3a823"}}):(0,s.jsx)(c.A,{className:"h-5 w-5"}),(0,s.jsx)("span",{className:"text-[10px] font-medium",style:w("/home")?{color:"#f3a823"}:{},children:"Home"})]}),(0,s.jsxs)(n(),{href:"/restaurants",className:`flex flex-col items-center justify-center space-y-0.5 transition-colors ${(w("/restaurants"),"text-gray-500 hover:text-gray-700")}`,children:[w("/restaurants")?(0,s.jsx)(m.A,{className:"h-5 w-5",style:{color:"#f3a823"}}):(0,s.jsx)(u.A,{className:"h-5 w-5"}),(0,s.jsx)("span",{className:"text-[10px] font-medium",style:w("/restaurants")?{color:"#f3a823"}:{},children:"Stores"})]}),(0,s.jsxs)(n(),{href:"/cart",className:`flex flex-col items-center justify-center space-y-0.5 transition-colors relative -top-2 ${w("/cart")?"text-gray-800":"text-gray-600"}`,children:[(0,s.jsxs)("div",{className:"w-10 h-10 bg-white rounded-full flex items-center justify-center relative",style:{boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15), 0 2px 4px rgba(0, 0, 0, 0.1)"},children:[w("/cart")?(0,s.jsx)(x.A,{className:"h-5 w-5 text-gray-800"}):(0,s.jsx)(d.A,{className:"h-5 w-5 text-gray-600"}),b>0&&(0,s.jsx)("span",{className:"absolute -top-1 -right-1 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-medium",style:{backgroundColor:"#f3a823"},children:b})]}),(0,s.jsx)("span",{className:"text-[10px] font-medium text-gray-500",children:"Cart"})]}),(0,s.jsxs)(n(),{href:"/search",className:`flex flex-col items-center justify-center space-y-0.5 transition-colors ${(w("/search"),"text-gray-500 hover:text-gray-700")}`,children:[w("/search")?(0,s.jsx)(p.A,{className:"h-5 w-5",style:{color:"#f3a823"}}):(0,s.jsx)(g.A,{className:"h-5 w-5"}),(0,s.jsx)("span",{className:"text-[10px] font-medium",style:w("/search")?{color:"#f3a823"}:{},children:"Search"})]}),(0,s.jsxs)(n(),{href:r||t?"/account":"/auth/signin",className:`flex flex-col items-center justify-center space-y-0.5 transition-colors ${(w("/profile"),"text-gray-500 hover:text-gray-700")}`,children:[w("/profile")?(0,s.jsx)(y.A,{className:"h-5 w-5",style:{color:"#f3a823"}}):(0,s.jsx)(h.A,{className:"h-5 w-5"}),(0,s.jsx)("span",{className:"text-[10px] font-medium",style:w("/profile")?{color:"#f3a823"}:{},children:"Account"})]})]})})}},26734:(e,t,r)=>{r.d(t,{A:()=>c});var s=r(60687),a=r(43210),n=r(16189),i=r(52238),o=r(54081),l=r(88522);function c({className:e="",iconSize:t="h-6 w-6",textColor:r="text-gray-600",hoverColor:c="hover:text-gray-900"}){let u=(0,n.useRouter)(),{token:d,permission:g,generateToken:h,setupForegroundListener:f}=(0,l.A8)(),{notifications:m,addNotification:x}=(0,l.E$)(),[p,y]=(0,a.useState)(!1);return(0,s.jsx)("div",{className:"relative",children:(0,s.jsxs)("button",{onClick:()=>{y(!1),u.push("/notifications")},className:`relative p-2 ${r} ${c} focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 rounded-full ${e}`,children:[p||m.length>0?(0,s.jsx)(o.A,{className:`${t} text-orange-500`}):(0,s.jsx)(i.A,{className:t}),m.length>0&&(0,s.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:m.length>9?"9+":m.length}),p&&(0,s.jsx)("span",{className:"absolute top-0 right-0 block h-2 w-2 bg-red-400 rounded-full animate-pulse"})]})})}},41350:(e,t,r)=>{r.d(t,{_:()=>n});var s=r(43210),a=r(63213);function n(){let{user:e,loading:t,isHydrated:r,isInitialized:n}=function(){let e=(0,a.A)(),[t,r]=(0,s.useState)(!1);return{user:t?e.user:null,loading:!t||e.loading,isAuthenticated:!!t&&!!e.user,authError:t?e.authError:null,isInitialized:!!t&&e.isInitialized,isHydrated:t,signIn:e.signIn,signUp:e.signUp,signOut:e.signOut,updateProfile:e.updateProfile}}();return{user:e,loading:t,isAuthenticated:!!e,isHydrated:r,isInitialized:n,canShowAuthContent:r&&n,canShowUserContent:r&&n&&!!e,canShowGuestContent:r&&n&&!e,shouldWaitForAuth:!r||!n||t}}},70440:(e,t,r)=>{r.r(t),r.d(t,{default:()=>a});var s=r(31658);let a=async e=>[{type:"image/x-icon",sizes:"16x16",url:(0,s.fillMetadataSegment)(".",await e.params,"favicon.ico")+""}]},88522:(e,t,r)=>{r.d(t,{A8:()=>d,E$:()=>g});var s=r(43210),a=r(14269),n=r(38724),i=r(33784);let o="BIZ720hEPOJI1onp93mfqutx5ceyFakOJPRM8R-Oa8eJibI5jsntq4PH-erjRy502Ac823zPQ63BTV5_qWxQUoQ";class l{static{this.messaging=null}static async initialize(){try{let e=await (0,i.H9)();return this.messaging=e,!!this.messaging}catch(e){return console.error("Failed to initialize FCM:",e),!1}}static async requestPermission(){if(!("Notification"in window))return console.warn("This browser does not support notifications"),"denied";if("granted"===Notification.permission)return"granted";if("denied"===Notification.permission)return"denied";let e=await Notification.requestPermission();return console.log("Notification permission:",e),e}static async generateToken(e){try{if(this.messaging||await this.initialize(),!this.messaging)throw Error("FCM not initialized");if(!o)throw Error("VAPID key not configured");let t=await this.requestPermission();if("granted"!==t)throw Error("Notification permission denied");let r=await (0,a.gf)(this.messaging,{vapidKey:o});if(r)return console.log("FCM token generated:",r),await this.storeToken(r,e),r;throw Error("Failed to generate FCM token")}catch(e){return console.error("Error generating FCM token:",e),null}}static async storeToken(e,t){try{let r={token:e,userId:t,deviceType:"web",userAgent:navigator.userAgent,createdAt:(0,n.O5)(),updatedAt:(0,n.O5)(),isActive:!0},s=(0,n.H9)(i.db,`users/${t}/fcmTokens`,e);await (0,n.BN)(s,r,{merge:!0}),console.log("FCM token stored successfully")}catch(e){throw console.error("Error storing FCM token:",e),e}}static async getStoredToken(e){try{return localStorage.getItem(`fcm_token_${e}`)}catch(e){return console.error("Error getting stored FCM token:",e),null}}static setupForegroundListener(e){if(!this.messaging)return void console.warn("FCM not initialized, cannot set up foreground listener");(0,a.xD)(this.messaging,t=>{console.log("Foreground message received:",t),e(t)})}static async showNotification(e){try{if(!("serviceWorker"in navigator))throw Error("Service Worker not supported");let t=await navigator.serviceWorker.ready,r={body:e.body,icon:e.icon||"/favicon.ico",badge:e.badge||"/favicon.ico",data:e.data,tag:"tap2go-notification",requireInteraction:!0,...e.image&&{image:e.image},...e.actions&&{actions:e.actions}};await t.showNotification(e.title,r)}catch(e){console.error("Error showing notification:",e)}}static handleNotificationClick(e){console.log("Notification clicked:",e.notification),e.notification.close();let t=e.notification.data;t?.url&&"undefined"!=typeof self&&"clients"in self&&e.waitUntil(self.clients.openWindow(t.url))}}var c=r(35905);let u=()=>{let[e,t]=(0,s.useState)({user:null,loading:!0,error:null});(0,s.useEffect)(()=>(0,c.hg)(i.j2,e=>{t(t=>({...t,user:e,loading:!1}))}),[]);let r=async(e,r)=>{try{t(e=>({...e,loading:!0,error:null}));let s=(await (0,c.x9)(i.j2,e,r)).user;return t(e=>({...e,user:s,loading:!1})),s}catch(r){let e=r.message||"Failed to sign in";return t(t=>({...t,loading:!1,error:e})),null}},a=async(e,r,s)=>{try{t(e=>({...e,loading:!0,error:null}));let a=(await (0,c.eJ)(i.j2,e,r)).user;return s&&await (0,c.r7)(a,{displayName:s}),t(e=>({...e,user:a,loading:!1})),a}catch(r){let e=r.message||"Failed to create account";return t(t=>({...t,loading:!1,error:e})),null}},n=async()=>{try{t(e=>({...e,loading:!0,error:null})),await (0,c.CI)(i.j2),t(e=>({...e,user:null,loading:!1}))}catch(r){let e=r.message||"Failed to sign out";t(t=>({...t,loading:!1,error:e}))}};return{...e,signIn:r,signUp:a,logout:n,clearError:()=>{t(e=>({...e,error:null}))}}},d=()=>{let{user:e}=u(),[t,r]=(0,s.useState)({token:null,permission:"default",isSupported:!1,isLoading:!0,error:null});(0,s.useEffect)(()=>{(async()=>{try{r(e=>({...e,isLoading:!0,error:null}));let t=await l.initialize(),s="Notification"in window?Notification.permission:"denied";if(r(e=>({...e,isSupported:t,permission:s,isLoading:!1})),e&&"granted"===s){let t=await l.getStoredToken(e.uid);t&&r(e=>({...e,token:t}))}}catch(e){console.error("Error initializing FCM:",e),r(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Failed to initialize FCM"}))}})()},[e]);let a=(0,s.useCallback)(async()=>{try{r(e=>({...e,isLoading:!0,error:null}));let e=await l.requestPermission();return r(t=>({...t,permission:e,isLoading:!1})),"granted"===e}catch(e){return console.error("Error requesting permission:",e),r(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Failed to request permission"})),!1}},[]),n=(0,s.useCallback)(async()=>{let t=e?.uid||"test_user_123";try{r(e=>({...e,isLoading:!0,error:null}));let e=await l.generateToken(t);return r(t=>({...t,token:e,isLoading:!1})),e&&localStorage.setItem(`fcm_token_${t}`,e),e}catch(e){return console.error("Error generating token:",e),r(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Failed to generate token"})),null}},[e]),i=(0,s.useCallback)(e=>{l.setupForegroundListener(e)},[]);return{...t,requestPermission:a,generateToken:n,setupForegroundListener:i}},g=()=>{let[e,t]=(0,s.useState)([]),r=(0,s.useCallback)(e=>{t(t=>[e,...t.slice(0,9)])},[]);return{notifications:e,addNotification:r,removeNotification:(0,s.useCallback)(e=>{t(t=>t.filter((t,r)=>r!==e))},[]),clearNotifications:(0,s.useCallback)(()=>{t([])},[])}}}};