exports.id=3259,exports.ids=[3259],exports.modules={1241:()=>{},11753:(e,i,t)=>{"use strict";t.d(i,{G7:()=>d,Rk:()=>o});let r={cloudName:"dpekh75yi",apiKey:process.env.CLOUDINARY_API_KEY,apiSecret:process.env.CLOUDINARY_API_SECRET},a=Object.entries(r).filter(([,e])=>!e).map(([e])=>e);a.length>0&&console.warn(`Missing Cloudinary environment variables: ${a.join(", ")}`),r.cloudName;let l=async()=>{let{v2:e}=await t.e(1870).then(t.t.bind(t,71870,23));return e.config().cloud_name||e.config({cloud_name:"dpekh75yi",api_key:process.env.CLOUDINARY_API_KEY,api_secret:process.env.CLOUDINARY_API_SECRET,secure:!0}),e},o=async(e,i={})=>{try{let t,r=await l();if("string"==typeof e)t=e;else{let i=await e.arrayBuffer(),r=Buffer.from(i).toString("base64");t=`data:${e.type};base64,${r}`}let a={upload_preset:"tap2go-uploads",folder:i.folder||"main-uploads",resource_type:"auto",...i};console.log("\uD83D\uDD04 Uploading to Cloudinary with options:",a);let o=await r.uploader.upload(t,a);return console.log("✅ Cloudinary upload successful:",o.public_id),o}catch(i){console.error("❌ Cloudinary upload error:",i);let e=i instanceof Error?i.message:"Unknown error";throw Error(`Cloudinary upload failed: ${e}`)}},d=async e=>{try{let i=await l(),t=await i.uploader.destroy(e);return"ok"===t.result}catch(e){return console.error("Cloudinary delete error:",e),!1}}},63511:(e,i,t)=>{"use strict";t.d(i,{E2:()=>s,ND:()=>d});var r=t(94202);let a="https://iblujnytqusttngujhob.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlibHVqbnl0cXVzdHRuZ3VqaG9iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkyNjQxNjMsImV4cCI6MjA2NDg0MDE2M30.zt4RCWmS3POQtULRl27UcdGGCPGbYPJvTr8l6YlOhvA",o=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!a||!l)throw Error("Missing Supabase environment variables. Please check your .env.local file.");let d=(0,r.createClient)(a,l,{auth:{persistSession:!1},db:{schema:"public"},realtime:{params:{eventsPerSecond:-1}},global:{headers:{"X-Client-Info":"tap2go-cms"}}}),s=o?(0,r.createClient)(a,o,{auth:{autoRefreshToken:!1,persistSession:!1},db:{schema:"public"},realtime:{params:{eventsPerSecond:-1}},global:{headers:{"X-Client-Info":"tap2go-cms-admin"}}}):null},72088:()=>{},78335:()=>{},80765:e=>{function i(e){var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}i.keys=()=>[],i.resolve=i,i.id=80765,e.exports=i},81234:(e,i,t)=>{"use strict";t.d(i,{H:()=>l});var r=t(63511),a=t(11753);class l{static getInstance(){return l.instance||(l.instance=new l),l.instance}async uploadFile(e,i){try{let t=await (0,a.Rk)(e,{upload_preset:"tap2go-uploads",folder:i.folder||"main-uploads",resource_type:"auto",tags:i.tags});console.log("\uD83D\uDCCB Cloudinary result:",{public_id:t.public_id,secure_url:t.secure_url,url:t.url,format:t.format,width:t.width,height:t.height});let l=await this.prepareMediaFileData(e,t,i),o=r.E2||r.ND,{data:d,error:s}=await o.from("media_files").insert(l).select("*").single();if(s)throw console.error("Error saving media file to database:",s),t.public_id&&await (0,a.G7)(t.public_id),Error(`Failed to save media file: ${s.message}`);return this.transformMediaFileData(d)}catch(e){throw console.error("Error uploading file:",e),e}}async getMediaFiles(e={},i={}){try{let t=(r.E2||r.ND).from("media_files").select(`
          *,
          folder_name:media_folders(name)
        `,{count:"exact"}).eq("status","active").is("deleted_at",null);e.query&&(t=t.textSearch("search_vector",e.query)),void 0!==e.folder_id&&(t=null===e.folder_id?t.is("folder_id",null):t.eq("folder_id",e.folder_id)),e.file_type&&(t=t.ilike("file_type",`${e.file_type}%`)),e.mime_type&&(t=t.eq("mime_type",e.mime_type)),e.status&&(t=t.eq("status",e.status)),e.visibility&&(t=t.eq("visibility",e.visibility)),e.uploaded_by&&(t=t.eq("uploaded_by",e.uploaded_by)),e.date_from&&(t=t.gte("created_at",e.date_from)),e.date_to&&(t=t.lte("created_at",e.date_to)),e.min_size&&(t=t.gte("file_size",e.min_size)),e.max_size&&(t=t.lte("file_size",e.max_size)),void 0!==e.is_used&&(t=t.eq("is_used",e.is_used));let a=i.sort_by||"created_at",l=i.sort_order||"desc";t=t.order(a,{ascending:"asc"===l});let o=i.page||1,d=i.limit||20,s=(o-1)*d;t=t.range(s,s+d-1);let{data:n,error:c,count:u}=await t;if(c)throw console.error("Error fetching media files:",c),Error(`Failed to fetch media files: ${c.message}`);return{data:(n||[]).map(this.transformMediaFileData),total:u||0,page:o,limit:d}}catch(e){throw console.error("Error in getMediaFiles:",e),e}}async getMediaFileById(e){try{let i=r.E2||r.ND,{data:t,error:a}=await i.from("media_files").select(`
          *,
          folder_name:media_folders(name)
        `).eq("id",e).eq("status","active").is("deleted_at",null).single();if(a){if("PGRST116"===a.code)return null;throw Error(`Failed to fetch media file: ${a.message}`)}return this.transformMediaFileData(t)}catch(e){throw console.error("Error fetching media file by ID:",e),e}}async updateMediaFile(e,i){try{let t=r.E2||r.ND,{data:a,error:l}=await t.from("media_files").update({...i,updated_at:new Date().toISOString()}).eq("id",e).select("*").single();if(l)throw Error(`Failed to update media file: ${l.message}`);return this.transformMediaFileData(a)}catch(e){throw console.error("Error updating media file:",e),e}}async deleteMediaFile(e,i){try{let t=r.E2||r.ND,{data:l}=await t.from("media_usage").select("id, entity_type, entity_id, usage_type").eq("media_file_id",e);if(l&&l.length>0){let e=l.map(e=>`${e.entity_type}:${e.entity_id} (${e.usage_type})`).join(", ");throw Error(`Cannot delete media file that is currently in use by: ${e}`)}let{data:o}=await t.from("media_files").select("cloudinary_public_id, filename").eq("id",e).single();if(o?.cloudinary_public_id)try{console.log("\uD83C\uDF29️ Deleting from Cloudinary during soft delete:",o.cloudinary_public_id),await (0,a.G7)(o.cloudinary_public_id)?console.log("✅ Successfully deleted from Cloudinary during soft delete"):console.warn("⚠️ Failed to delete from Cloudinary, but continuing with soft delete")}catch(e){console.error("❌ Cloudinary deletion error during soft delete:",e)}let{error:d}=await t.from("media_files").update({status:"deleted",deleted_at:new Date().toISOString(),deleted_by:i,updated_at:new Date().toISOString()}).eq("id",e);if(d)throw Error(`Failed to delete media file: ${d.message}`);return console.log("✅ Successfully soft deleted media file:",{id:e,filename:o?.filename,cloudinary_deleted:!!o?.cloudinary_public_id}),!0}catch(e){throw console.error("Error deleting media file:",e),e}}async hardDeleteMediaFile(e,i){try{let i=r.E2||r.ND,{data:t,error:l}=await i.from("media_files").select("cloudinary_public_id, filename, file_url").eq("id",e).single();if(l)throw Error(`Failed to fetch media file: ${l.message}`);if(!t)throw Error("Media file not found");if(console.log("\uD83D\uDDD1️ Starting hard delete for file:",{id:e,filename:t.filename,cloudinary_public_id:t.cloudinary_public_id}),t.cloudinary_public_id)try{console.log("\uD83C\uDF29️ Deleting from Cloudinary:",t.cloudinary_public_id),await (0,a.G7)(t.cloudinary_public_id)?console.log("✅ Successfully deleted from Cloudinary"):console.warn("⚠️ Failed to delete from Cloudinary, but continuing with database deletion")}catch(e){console.error("❌ Cloudinary deletion error:",e)}let{error:o}=await i.from("media_usage").delete().eq("media_file_id",e);o&&console.warn("⚠️ Error deleting media usage records:",o);let{error:d}=await i.from("media_file_tags").delete().eq("media_file_id",e);d&&console.warn("⚠️ Error deleting media file tags:",d);let{error:s}=await i.from("media_collection_items").delete().eq("media_file_id",e);s&&console.warn("⚠️ Error deleting media collection items:",s);let{error:n}=await i.from("media_processing_jobs").delete().eq("media_file_id",e);n&&console.warn("⚠️ Error deleting media processing jobs:",n);let{error:c}=await i.from("media_files").delete().eq("id",e);if(c)throw Error(`Failed to delete media file from database: ${c.message}`);return console.log("✅ Successfully hard deleted media file:",{id:e,filename:t.filename}),!0}catch(e){throw console.error("❌ Error hard deleting media file:",e),e}}async getFolders(){try{let e=r.E2||r.ND,{data:i,error:t}=await e.from("media_folders").select("*").order("path");if(t)throw Error(`Failed to fetch folders: ${t.message}`);return i||[]}catch(e){throw console.error("Error fetching folders:",e),e}}async createFolder(e,i,t,a){try{let l=r.E2||r.ND,o=e.toLowerCase().replace(/[^a-z0-9]+/g,"-"),d=`/${o}`;if(i){let{data:e}=await l.from("media_folders").select("path").eq("id",i).single();e&&(d=`${e.path}/${o}`)}let{data:s,error:n}=await l.from("media_folders").insert({name:e,slug:`${o}-${Date.now()}`,description:t,parent_id:i,path:d,is_system:!1,created_by:a}).select("*").single();if(n)throw Error(`Failed to create folder: ${n.message}`);return s}catch(e){throw console.error("Error creating folder:",e),e}}async prepareMediaFileData(e,i,t){let a=null;if(t.folder){let e=r.E2||r.ND,{data:i}=await e.from("media_folders").select("id").eq("path",`/${t.folder}`).single();a=i?.id||null}let l=e.type.startsWith("image/")?"image":e.type.startsWith("video/")?"video":"document",o=null;return i.width&&i.height&&(o=(i.width/i.height).toFixed(4)),{filename:e.name,original_filename:e.name,file_path:i.public_id,file_url:i.secure_url,thumbnail_url:"image"===l?i.secure_url.replace("/upload/","/upload/c_thumb,w_300,h_300/"):null,file_type:l,mime_type:e.type,file_size:e.size,file_extension:e.name.split(".").pop()?.toLowerCase()||"",width:i.width||null,height:i.height||null,aspect_ratio:o,alt_text:t.alt_text,caption:t.caption,description:t.description,title:t.title,folder_id:a,folder_path:t.folder?`/${t.folder}`:"/",cloudinary_public_id:i.public_id,cloudinary_version:i.version?.toString(),storage_provider:"cloudinary",uploaded_by:t.uploaded_by,upload_source:"admin_panel",status:"active",visibility:t.visibility||"public"}}transformMediaFileData(e){return{...e,tags:e.tags||[],folder_name:e.folder_name?.name||null}}}},96487:()=>{}};