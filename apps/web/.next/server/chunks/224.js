exports.id=224,exports.ids=[224],exports.modules={66212:(e,t,s)=>{"use strict";s.d(t,{JS:()=>c,Vh:()=>a,ac:()=>u,yY:()=>i});var r=s(93353);let a=async(e,t={},s={})=>{try{let{from:a=0,size:i=20,sortBy:o="relevance",sortOrder:n="desc"}=s,c={from:a,size:i,query:{bool:{must:[],filter:[],should:[]}},aggs:{cuisines:{terms:{field:"cuisine",size:20}},avgRating:{avg:{field:"rating"}},priceRanges:{range:{field:"deliveryFee",ranges:[{key:"free",to:1},{key:"low",from:1,to:50},{key:"medium",from:50,to:100},{key:"high",from:100}]}}}};if(e&&e.trim()){let t=e.trim();c.query.bool.should=[{multi_match:{query:t,fields:["name^5","description^3","cuisine^2"],type:"phrase",boost:3}},{multi_match:{query:t,fields:["name^4","description^2.5","cuisine^2","address.street","address.city"],fuzziness:"AUTO",operator:"or",boost:2}},{query_string:{query:`*${t.toLowerCase()}*`,fields:["name^2","cuisine^1.5"],boost:1.5}},...t.split(" ").map(e=>({fuzzy:{name:{value:e,fuzziness:e.length>4?2:1,boost:1}}})),{fuzzy:{cuisine:{value:t,fuzziness:"AUTO",boost:1.2}}}],c.query.bool.minimum_should_match=1}else c.query.bool.must.push({match_all:{}});if(t.cuisine&&t.cuisine.length>0&&c.query.bool.filter.push({terms:{cuisine:t.cuisine}}),t.minRating&&c.query.bool.filter.push({range:{rating:{gte:t.minRating}}}),t.maxDeliveryFee&&c.query.bool.filter.push({range:{deliveryFee:{lte:t.maxDeliveryFee}}}),void 0!==t.isOpen&&c.query.bool.filter.push({term:{isOpen:t.isOpen}}),t.location&&c.query.bool.filter.push({geo_distance:{distance:t.location.radius||"10km",location:{lat:t.location.lat,lon:t.location.lng}}}),t.priceRange){let e={};void 0!==t.priceRange.min&&(e.gte=t.priceRange.min),void 0!==t.priceRange.max&&(e.lte=t.priceRange.max),Object.keys(e).length>0&&c.query.bool.filter.push({range:{deliveryFee:e}})}let u=[];"relevance"===o?u.push({_score:{order:n}}):"rating"===o?u.push({rating:{order:n}}):"distance"===o&&t.location&&u.push({_geo_distance:{location:{lat:t.location.lat,lon:t.location.lng},order:n,unit:"km"}}),"rating"!==o&&u.push({rating:{order:"desc"}}),u.push({_score:{order:"desc"}}),c.sort=u;let l=await r.IN.search({index:r.Wr.RESTAURANTS,body:c}),d=l.body.hits.hits.map(e=>({...e._source,id:e._id,_score:e._score})),y="object"==typeof l.body.hits.total?l.body.hits.total.value||0:l.body.hits.total||0,g={cuisines:l.body.aggregations?.cuisines?.buckets?.map(e=>({key:e.key,count:e.doc_count}))||[],avgRating:l.body.aggregations?.avgRating?.value||0,priceRanges:l.body.aggregations?.priceRanges?.buckets?.map(e=>({key:e.key,count:e.doc_count}))||[]};return{restaurants:d,total:y,aggregations:g}}catch(e){throw console.error("Bonsai search error:",e),Error("Search failed. Please try again.")}},i=async e=>{try{if(!e||e.length<2)return[];let t=await r.IN.search({index:r.Wr.RESTAURANTS,body:{size:0,query:{bool:{should:[{fuzzy:{name:{value:e,fuzziness:"AUTO",prefix_length:1,max_expansions:50}}},{wildcard:{"name.keyword":{value:`*${e.toLowerCase()}*`,boost:.8}}},{fuzzy:{cuisine:{value:e,fuzziness:"AUTO",boost:.6}}},{match:{name:{query:e,fuzziness:"AUTO",operator:"or",boost:1.2}}}],minimum_should_match:1}},aggs:{suggestions:{terms:{field:"name.keyword",size:10,order:{_count:"desc"}}},cuisine_suggestions:{terms:{field:"cuisine",size:5,order:{_count:"desc"}}}}}}),s=t.body.aggregations?.suggestions?.buckets?.map(e=>e.key)||[],a=t.body.aggregations?.cuisine_suggestions?.buckets?.map(e=>e.key)||[],i=[...s,...a],n=[...new Set(i)];if(0===n.length)return await o(e);return n.slice(0,8)}catch(t){return console.error("Suggestion error:",t),await o(e)}},o=async e=>{try{let t=(await r.IN.search({index:r.Wr.RESTAURANTS,body:{size:10,query:{bool:{should:[{fuzzy:{name:{value:e,fuzziness:2,prefix_length:0,max_expansions:100}}},{match:{name:{query:e,fuzziness:2,operator:"or"}}}]}},_source:["name","cuisine"]}})).body.hits.hits.map(e=>e._source.name);return[...new Set(t)]}catch(e){return console.error("Fallback suggestion error:",e),[]}},n=e=>({burger:["hamburger","cheeseburger","sandwich"],pizza:["pie","flatbread"],chinese:["asian","oriental"],italian:["pasta","spaghetti"],mexican:["tex-mex","latino"],indian:["curry","spicy"],japanese:["sushi","ramen","asian"],thai:["asian","spicy"],coffee:["cafe","espresso","latte"],dessert:["sweet","cake","ice cream"],healthy:["salad","organic","fresh"],fast:["quick","express"],brger:["burger","hamburger"],piza:["pizza"],chiken:["chicken"],resturant:["restaurant"],restraunt:["restaurant"],restaraunt:["restaurant"],chinse:["chinese"],itallian:["italian"],mexcan:["mexican"],japenese:["japanese"],cofee:["coffee"],desrt:["dessert"],helthy:["healthy"]})[e.toLowerCase()]||[],c=async e=>{try{if(!e||e.length<2)return[];let t=n(e),s=[e,...t],a=await r.IN.search({index:r.Wr.RESTAURANTS,body:{size:0,query:{bool:{should:[...s.flatMap(t=>[{fuzzy:{name:{value:t,fuzziness:"AUTO",prefix_length:1,max_expansions:50,boost:t===e?2:1}}},{wildcard:{"name.keyword":{value:`*${t.toLowerCase()}*`,boost:t===e?1.5:.8}}},{match:{cuisine:{query:t,fuzziness:"AUTO",boost:t===e?1.2:.8}}}])],minimum_should_match:1}},aggs:{suggestions:{terms:{field:"name.keyword",size:8,order:{_count:"desc"}}},cuisine_suggestions:{terms:{field:"cuisine",size:4,order:{_count:"desc"}}}}}}),i=a.body.aggregations?.suggestions?.buckets?.map(e=>e.key)||[],o=a.body.aggregations?.cuisine_suggestions?.buckets?.map(e=>e.key)||[],c=[...i,...o];return[...new Set(c)].slice(0,8)}catch(e){return console.error("Intelligent suggestions error:",e),[]}},u=async()=>["Pizza","Burger","Chinese","Italian","Fast food","Healthy","Dessert","Coffee","Sushi","Mexican"]},78335:()=>{},93353:(e,t,s)=>{"use strict";s.d(t,{GR:()=>g,HX:()=>l,IN:()=>c,V3:()=>u,Wr:()=>d});var r=s(47458);let a=process.env.BONSAI_HOST,i=process.env.BONSAI_USERNAME,o=process.env.BONSAI_PASSWORD,n=process.env.BONSAI_URL;if(!a&&!n)throw Error("Missing Bonsai configuration. Please set BONSAI_HOST + credentials or BONSAI_URL in .env.local");let c=new r.Kj({...a&&{node:a,auth:{username:i,password:o}},...n&&!a&&{node:n},requestTimeout:3e4,pingTimeout:3e3,maxRetries:3,ssl:{rejectUnauthorized:!0}}),u=async()=>{try{return await c.ping(),console.log("✅ Bonsai Elasticsearch connection successful"),!0}catch(e){return console.error("❌ Bonsai Elasticsearch connection failed:",e),!1}},l=async()=>{try{let e=await c.info();return console.log("\uD83D\uDCCA Bonsai Cluster Info:",{name:e.body.cluster_name,version:e.body.version.number,lucene_version:e.body.version.lucene_version}),e.body}catch(e){throw console.error("Error getting cluster info:",e),e}},d={RESTAURANTS:"tap2go_restaurants",MENU_ITEMS:"tap2go_menu_items",CATEGORIES:"tap2go_categories",REVIEWS:"tap2go_reviews"},y={settings:{number_of_shards:1,number_of_replicas:0,analysis:{analyzer:{restaurant_analyzer:{type:"custom",tokenizer:"standard",filter:["lowercase","asciifolding","stop"]}}}},mappings:{properties:{id:{type:"keyword"},name:{type:"text",analyzer:"restaurant_analyzer",fields:{keyword:{type:"keyword"},suggest:{type:"completion"}}},description:{type:"text",analyzer:"restaurant_analyzer"},cuisine:{type:"keyword"},rating:{type:"float"},reviewCount:{type:"integer"},deliveryTime:{type:"keyword"},deliveryFee:{type:"float"},minimumOrder:{type:"float"},isOpen:{type:"boolean"},featured:{type:"boolean"},location:{type:"geo_point"},address:{type:"object",properties:{street:{type:"text"},city:{type:"keyword"},state:{type:"keyword"},zipCode:{type:"keyword"},country:{type:"keyword"}}},operatingHours:{type:"object",properties:{monday:{type:"object"},tuesday:{type:"object"},wednesday:{type:"object"},thursday:{type:"object"},friday:{type:"object"},saturday:{type:"object"},sunday:{type:"object"}}},createdAt:{type:"date"},updatedAt:{type:"date"}}}},g=async()=>{try{return(await c.indices.exists({index:d.RESTAURANTS})).body?console.log("✅ Restaurants index already exists"):(console.log("Creating restaurants index..."),await c.indices.create({index:d.RESTAURANTS,body:y}),console.log("✅ Restaurants index created")),!0}catch(e){throw console.error("Error initializing indices:",e),e}}},96487:()=>{}};