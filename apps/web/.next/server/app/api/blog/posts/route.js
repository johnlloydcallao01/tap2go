(()=>{var e={};e.id=2494,e.ids=[2494],e.modules={1241:()=>{},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},63511:(e,t,s)=>{"use strict";s.d(t,{E2:()=>i,ND:()=>n});var r=s(94202);let o="https://iblujnytqusttngujhob.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlibHVqbnl0cXVzdHRuZ3VqaG9iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkyNjQxNjMsImV4cCI6MjA2NDg0MDE2M30.zt4RCWmS3POQtULRl27UcdGGCPGbYPJvTr8l6YlOhvA",l=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!o||!a)throw Error("Missing Supabase environment variables. Please check your .env.local file.");let n=(0,r.createClient)(o,a,{auth:{persistSession:!1},db:{schema:"public"},realtime:{params:{eventsPerSecond:-1}},global:{headers:{"X-Client-Info":"tap2go-cms"}}}),i=l?(0,r.createClient)(o,l,{auth:{autoRefreshToken:!1,persistSession:!1},db:{schema:"public"},realtime:{params:{eventsPerSecond:-1}},global:{headers:{"X-Client-Info":"tap2go-cms-admin"}}}):null},65160:(e,t,s)=>{"use strict";s.r(t),s.d(t,{patchFetch:()=>_,routeModule:()=>m,serverHooks:()=>w,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>b});var r={};s.r(r),s.d(r,{DELETE:()=>h,GET:()=>g,POST:()=>d,PUT:()=>p});var o=s(96559),a=s(48088),l=s(37719),n=s(32190),i=s(63511);function c(){return i.E2?i.E2:(console.warn("⚠️ Using regular client - admin client not available"),i.ND)}class u{static async getPublishedPosts(e=10,t=0){let{data:s,error:r}=await i.ND.from("blog_posts").select(`
        *,
        categories:post_categories(category:categories(*)),
        tags:post_tags(tag:tags(*))
      `).eq("status","published").is("deleted_at",null).lte("published_at",new Date().toISOString()).order("published_at",{ascending:!1}).range(t,t+e-1);if(r)throw r;return s}static async getFeaturedPosts(e=5){let{data:t,error:s}=await i.ND.from("blog_posts").select(`
        *,
        categories:post_categories(category:categories(*)),
        tags:post_tags(tag:tags(*))
      `).eq("status","published").eq("is_featured",!0).lte("published_at",new Date().toISOString()).order("published_at",{ascending:!1}).limit(e);if(s)throw s;return t}static async getPostBySlug(e){let{data:t,error:s}=await i.ND.from("blog_posts").select(`
        *,
        categories:post_categories(category:categories(*)),
        tags:post_tags(tag:tags(*))
      `).eq("slug",e).eq("status","published").single();if(s)throw s;return t&&i.E2&&await i.E2.from("blog_posts").update({view_count:t.view_count+1}).eq("id",t.id),t}static async searchPosts(e,t=10){let{data:s,error:r}=await i.ND.from("blog_posts").select(`
        *,
        categories:post_categories(category:categories(*)),
        tags:post_tags(tag:tags(*))
      `).eq("status","published").textSearch("search_vector",e).order("published_at",{ascending:!1}).limit(t);if(r)throw r;return s}static async getPostsByCategory(e,t=10,s=0){let{data:r,error:o}=await i.ND.from("blog_posts").select(`
        *,
        categories:post_categories!inner(category:categories!inner(*)),
        tags:post_tags(tag:tags(*))
      `).eq("status","published").eq("categories.category.slug",e).order("published_at",{ascending:!1}).range(s,s+t-1);if(o)throw o;return r}static async getPostsByTag(e,t=10,s=0){let{data:r,error:o}=await i.ND.from("blog_posts").select(`
        *,
        categories:post_categories(category:categories(*)),
        tags:post_tags!inner(tag:tags!inner(*))
      `).eq("status","published").eq("tags.tag.slug",e).order("published_at",{ascending:!1}).range(s,s+t-1);if(o)throw o;return r}static async getAllPosts(e=100,t=0){try{let{data:s,error:r}=await c().from("blog_posts").select("*").is("deleted_at",null).order("created_at",{ascending:!1}).range(t,t+e-1);if(r)throw console.error("❌ getAllPosts error:",r),r;return s}catch(e){throw console.error("❌ getAllPosts failed:",e),e}}static async getAllPostsIncludingTrashed(e=1e3,t=0){try{let{data:s,error:r}=await c().from("blog_posts").select("*").order("created_at",{ascending:!1}).range(t,t+e-1);if(r)throw console.error("❌ getAllPostsIncludingTrashed error:",r),r;return s}catch(e){throw console.error("❌ getAllPostsIncludingTrashed failed:",e),e}}static async getPostsByStatus(e="all",t=100,s=0){try{let r=c().from("blog_posts").select("*");r="trash"===e?r.not("deleted_at","is",null):"all"===e?r.is("deleted_at",null):r.eq("status",e).is("deleted_at",null);let{data:o,error:a}=await r.order("trash"===e?"deleted_at":"created_at",{ascending:!1}).range(s,s+t-1);if(a)throw console.error("❌ getPostsByStatus error:",a),a;return o}catch(e){throw console.error("❌ getPostsByStatus failed:",e),e}}static async getTrashedPosts(e=100,t=0){try{let{data:s,error:r}=await c().from("blog_posts").select("*").not("deleted_at","is",null).order("deleted_at",{ascending:!1}).range(t,t+e-1);if(r)throw console.error("❌ getTrashedPosts error:",r),r;return s}catch(e){throw console.error("❌ getTrashedPosts failed:",e),e}}static async createPost(e){try{console.log("\uD83D\uDCDD Creating post with data:",e);let t={title:e.title||"Untitled",slug:e.slug||(e.title||"untitled").toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim(),content:e.content||"",excerpt:e.excerpt||"",status:e.status||"draft",author_name:e.author_name||"Admin",is_featured:e.is_featured||!1,reading_time:e.reading_time||0,view_count:e.view_count||0};"published"===e.status&&(t.published_at=new Date().toISOString()),console.log("\uD83D\uDCCB Insert data:",t);let{data:s,error:r}=await c().from("blog_posts").insert([t]).select().single();if(r)throw console.error("❌ Create post error details:",{message:r.message,details:r.details,hint:r.hint,code:r.code}),Error(`Database error: ${r.message}`);return console.log("✅ Post created successfully:",s),s}catch(e){throw console.error("❌ Create post failed:",e),e}}static async updatePost(e,t){let{data:s,error:r}=await c().from("blog_posts").update({...t,published_at:"published"!==t.status||t.published_at?t.published_at:new Date().toISOString()}).eq("id",e).select().single();if(r)throw r;return s}static async moveToTrash(e,t){try{console.log("\uD83D\uDDD1️ Moving post to trash:",{id:e,userId:t});let{data:s,error:r}=await c().from("blog_posts").update({deleted_at:new Date().toISOString(),deleted_by:t||null,status:"trash",updated_at:new Date().toISOString()}).eq("id",e).is("deleted_at",null).select().single();if(r)throw console.error("❌ moveToTrash error details:",{message:r.message,details:r.details,hint:r.hint,code:r.code}),Error(`Trash error: ${r.message}`);return console.log("✅ Post moved to trash successfully:",s),s}catch(e){throw console.error("❌ moveToTrash failed:",e),e}}static async restoreFromTrash(e,t="draft"){try{console.log("♻️ Restoring post from trash:",{id:e,newStatus:t});let{data:s,error:r}=await c().from("blog_posts").update({deleted_at:null,deleted_by:null,status:t,updated_at:new Date().toISOString()}).eq("id",e).not("deleted_at","is",null).select().single();if(r)throw console.error("❌ restoreFromTrash error:",r),r;return console.log("✅ Post restored from trash successfully:",s),s}catch(e){throw console.error("❌ restoreFromTrash failed:",e),e}}static async permanentDelete(e){try{console.log("\uD83D\uDDD1️ Permanently deleting post:",{id:e});let{error:t}=await c().from("blog_posts").delete().eq("id",e).not("deleted_at","is",null);if(t)throw console.error("❌ permanentDelete error:",t),t;return console.log("✅ Post permanently deleted successfully"),!0}catch(e){throw console.error("❌ permanentDelete failed:",e),e}}static async deletePost(e,t){return console.warn("deletePost is deprecated. Use moveToTrash instead."),this.moveToTrash(e,t)}}async function g(e){try{let t;if(console.log("\uD83D\uDCD6 Fetching blog posts..."),!i.E2)throw Error("Supabase admin client not available");let{searchParams:s}=new URL(e.url),r=parseInt(s.get("page")||"1"),o=parseInt(s.get("limit")||"10"),a=s.get("status")||"all";console.log("\uD83D\uDD0D Query parameters:",{page:r,limit:o,status:a}),t="all"===a?await u.getAllPosts(o,(r-1)*o):"trash"===a?await u.getTrashedPosts():"published"===a||"draft"===a?await u.getPostsByStatus(a,o):await u.getAllPosts(o,(r-1)*o);let l=await u.getAllPostsIncludingTrashed(1e3),c=l?.length||0,g={total:l?.filter(e=>!e.deleted_at).length||0,published:l?.filter(e=>"published"===e.status&&!e.deleted_at).length||0,draft:l?.filter(e=>"draft"===e.status&&!e.deleted_at).length||0,trash:l?.filter(e=>e.deleted_at).length||0},d=Math.ceil(c/o);return console.log(`✅ Found ${t?.length||0} posts`),n.NextResponse.json({success:!0,posts:t||[],pagination:{currentPage:r,totalPages:d,totalCount:c,limit:o},stats:g})}catch(e){return console.error("❌ Error fetching blog posts:",e),n.NextResponse.json({success:!1,message:"Failed to fetch blog posts",error:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function d(e){try{if(console.log("\uD83D\uDCDD Creating new blog post..."),!i.E2)throw Error("Supabase admin client not available");let t=await e.json();console.log("\uD83D\uDCDD Post data:",t);let s=await u.createPost(t);if(s)return console.log("✅ Post created successfully:",s.id),n.NextResponse.json({success:!0,message:"Post created successfully",post:s});throw Error("Failed to create post")}catch(e){return console.error("❌ Error creating blog post:",e),n.NextResponse.json({success:!1,message:"Failed to create blog post",error:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function p(e){try{if(console.log("\uD83D\uDCDD Updating blog post..."),!i.E2)throw Error("Supabase admin client not available");let{id:t,...s}=await e.json();if(!t)return n.NextResponse.json({success:!1,message:"Post ID is required"},{status:400});let r=await u.updatePost(t,s);if(r)return console.log("✅ Post updated successfully:",r.id),n.NextResponse.json({success:!0,message:"Post updated successfully",post:r});throw Error("Failed to update post")}catch(e){return console.error("❌ Error updating blog post:",e),n.NextResponse.json({success:!1,message:"Failed to update blog post",error:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function h(e){try{if(console.log("\uD83D\uDDD1️ Deleting blog post..."),!i.E2)throw Error("Supabase admin client not available");let{searchParams:t}=new URL(e.url),s=t.get("id");if(!s)return n.NextResponse.json({success:!1,message:"Post ID is required"},{status:400});if(await u.moveToTrash(parseInt(s),"admin"))return console.log("✅ Post moved to trash successfully:",s),n.NextResponse.json({success:!0,message:"Post moved to trash successfully"});throw Error("Failed to move post to trash")}catch(e){return console.error("❌ Error deleting blog post:",e),n.NextResponse.json({success:!1,message:"Failed to delete blog post",error:e instanceof Error?e.message:"Unknown error"},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/blog/posts/route",pathname:"/api/blog/posts",filename:"route",bundlePath:"app/api/blog/posts/route"},resolvedPagePath:"C:\\Users\\ACER\\Desktop\\tap2go\\apps\\web\\src\\app\\api\\blog\\posts\\route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:f,workUnitAsyncStorage:b,serverHooks:w}=m;function _(){return(0,l.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:b})}},72088:()=>{},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},80765:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=80765,e.exports=t},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[4447,580,4202],()=>s(65160));module.exports=r})();