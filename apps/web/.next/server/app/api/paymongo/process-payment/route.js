(()=>{var e={};e.id=4995,e.ids=[4995],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12412:e=>{"use strict";e.exports=require("assert")},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},38985:(e,t,a)=>{"use strict";a.d(t,{Mk:()=>u,T7:()=>i,TF:()=>c,Ub:()=>p,Zd:()=>l,hx:()=>m,lx:()=>d});var r=a(94612);let o=process.env.PAYMONGO_PUBLIC_KEY_LIVE,s=process.env.PAYMONGO_SECRET_KEY_LIVE,n=(e=!1)=>{let t=e?s:o;if(!t)throw Error(`PayMongo ${e?"secret":"public"} key is not configured. Please check your environment variables.`);let a=Buffer.from(`${t}:`).toString("base64");return r.A.create({baseURL:"https://api.paymongo.com/v1",headers:{Authorization:`Basic ${a}`,"Content-Type":"application/json",Accept:"application/json"},timeout:3e4})},i=n(!1),p=n(!0),c=e=>e.response?.data?.errors?e.response.data.errors.map(e=>e.detail).join(", "):e.message?e.message:"An unexpected error occurred with the payment gateway.",l=e=>Math.round(100*e),u=e=>e/100,m=e=>e>=20&&e<=999999.99,d=()=>["card","gcash","grab_pay","paymaya","billease","dob"]},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},77274:(e,t,a)=>{"use strict";a.r(t),a.d(t,{patchFetch:()=>g,routeModule:()=>u,serverHooks:()=>y,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>d});var r={};a.r(r),a.d(r,{GET:()=>l,POST:()=>c});var o=a(96559),s=a(48088),n=a(37719),i=a(32190),p=a(38985);async function c(e){try{var t,a,r;let{paymentMethod:o,amount:s,description:n,customerInfo:c}=await e.json();if(console.log("\uD83D\uDE80 Processing real PayMongo payment:",{paymentMethod:o,amount:s,description:n}),!o||!s)return i.NextResponse.json({success:!1,error:"Payment method and amount are required"},{status:400});if(!process.env.PAYMONGO_SECRET_KEY_LIVE)return i.NextResponse.json({success:!1,error:"PayMongo secret key not configured"},{status:500});let l={data:{attributes:{amount:Math.round(100*s),currency:"PHP",description:n||"Tap2Go Order Payment",statement_descriptor:"Tap2Go",payment_method_allowed:[o],metadata:{order_id:`order_${Date.now()}`,customer_name:c?.name||"Customer",customer_email:c?.email||"",platform:"tap2go",payment_method:o}}}};console.log("\uD83D\uDCE1 Creating PayMongo payment intent...");let u=await p.Ub.post("/payment_intents",l),m=u.data?.data;console.log("✅ Payment intent created:",m?.id);let d=null,y=null,g=!1;if("gcash"===o||"grab_pay"===o||"paymaya"===o){console.log(`📱 Creating REAL ${o} payment method...`);let e=process.env.NEXT_PUBLIC_APP_URL||"http://localhost:3001";try{console.log("\uD83D\uDE80 Creating payment method with PayMongo..."),d=await p.Ub.post("/payment_methods",{data:{attributes:{type:o,billing:{name:"Test Customer",email:"test@tap2go.com",phone:"+639123456789"}}}});let t=d.data?.data?.id;console.log("✅ Payment method created:",t);let a={data:{attributes:{payment_method:t,return_url:`${e}/payment-success?payment_intent=${m?.id}`}}};console.log("\uD83D\uDD17 Attaching payment method to payment intent...");let r=await p.Ub.post(`/payment_intents/${m?.id}/attach`,a);console.log("\uD83D\uDCCB Attach response:",r.data?.data?.attributes);let s=r.data?.data?.attributes,n=s?.next_action;n?.type==="redirect"&&(y=n.redirect?.url,g=!0,console.log("\uD83C\uDF10 REAL CHECKOUT URL CREATED:",y),console.log("\uD83C\uDFAF This will redirect to actual",o.toUpperCase(),"payment page!"))}catch(e){console.error("❌ Payment method creation/attachment error:",{status:e.response?.status,data:e.response?.data,message:e.message});try{console.log("\uD83D\uDD04 Trying alternative approach...");let e=await p.Ub.get(`/payment_intents/${m?.id}`),t=e.data?.data?.attributes?.next_action;t?.type==="redirect"&&(y=t.redirect?.url,g=!0,console.log("\uD83C\uDF10 Alternative checkout URL found:",y))}catch(e){console.error("Alternative approach also failed:",e)}}}return"card"===o&&console.log("\uD83D\uDCB3 Card payment selected - would need card form integration"),i.NextResponse.json({success:!0,message:g?`🚀 REAL ${o.toUpperCase()} payment ready! Click to proceed to actual payment.`:`Payment intent created for ${o}`,paymentIntent:{id:m?.id,amount:m?.attributes?.amount,currency:m?.attributes?.currency,status:m?.attributes?.status,client_key:m?.attributes?.client_key,payment_method:o,description:m?.attributes?.description},paymentMethod:d?.data?.data||null,checkoutUrl:y,realPaymentFlow:g,nextSteps:(t=o,a=y,({gcash:{title:(r=g)?"\uD83D\uDE80 REAL GCash Payment Ready!":"GCash Payment",steps:a?['\uD83C\uDFAF Click "Proceed to GCash" below for REAL payment',"\uD83D\uDCF1 You will be redirected to actual GCash payment page","\uD83D\uDD10 Log in with your real GCash account","\uD83D\uDCB0 Confirm the ₱300.00 payment amount","✅ Complete the actual payment transaction","\uD83D\uDD04 You will be redirected back to Tap2Go after payment"]:["Open your GCash app","Scan the QR code or enter merchant details","Enter the payment amount: ₱300.00","Confirm the payment"],redirectUrl:a},grab_pay:{title:r?"\uD83D\uDE80 REAL GrabPay Payment Ready!":"GrabPay Payment",steps:a?['\uD83C\uDFAF Click "Proceed to GrabPay" below for REAL payment',"\uD83D\uDE97 You will be redirected to actual GrabPay payment page","\uD83D\uDD10 Log in with your real Grab account","\uD83D\uDCB0 Confirm the ₱300.00 payment amount","✅ Complete the actual payment transaction","\uD83D\uDD04 You will be redirected back to Tap2Go after payment"]:["Open your Grab app","Go to GrabPay section","Scan QR code or enter payment details","Confirm payment"],redirectUrl:a},paymaya:{title:r?"\uD83D\uDE80 REAL Maya Payment Ready!":"Maya Payment",steps:a?['\uD83C\uDFAF Click "Proceed to Maya" below for REAL payment',"\uD83C\uDFE6 You will be redirected to actual Maya payment page","\uD83D\uDD10 Log in with your real Maya account","\uD83D\uDCB0 Confirm the ₱300.00 payment amount","✅ Complete the actual payment transaction","\uD83D\uDD04 You will be redirected back to Tap2Go after payment"]:["Open your Maya app","Use QR code scanner or enter details","Confirm payment amount","Complete payment"],redirectUrl:a},card:{title:"Credit/Debit Card Payment",steps:["Enter your card details","Provide card number, expiry, and CVV","Confirm billing information","Complete 3D Secure verification if required"]},billease:{title:"BillEase Payment",steps:["You will be redirected to BillEase","Log in or create BillEase account","Choose your payment plan","Complete the application"]},dob:{title:"Online Banking",steps:["Select your bank","You will be redirected to your bank's website","Log in to your online banking","Authorize the payment"]}})[t]||{title:"Payment Processing",steps:["Follow the payment instructions","Complete the transaction"]}),timestamp:new Date().toISOString()})}catch(a){console.error("Process payment error:",a);let e="Payment processing failed",t=500;return a&&"object"==typeof a&&"response"in a?(e=a.response?.data?.errors?.[0]?.detail||a.response?.data?.message||a.message||"Unknown error",t=a.response?.status||500):a instanceof Error&&(e=a.message),i.NextResponse.json({success:!1,error:e,details:a&&"object"==typeof a&&"response"in a?a.response?.data:a instanceof Error?a.message:"Unknown error",timestamp:new Date().toISOString()},{status:t})}}async function l(){return i.NextResponse.json({error:"Method not allowed. Use POST to process payments."},{status:405})}let u=new o.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/paymongo/process-payment/route",pathname:"/api/paymongo/process-payment",filename:"route",bundlePath:"app/api/paymongo/process-payment/route"},resolvedPagePath:"C:\\Users\\ACER\\Desktop\\tap2go\\apps\\web\\src\\app\\api\\paymongo\\process-payment\\route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:m,workUnitAsyncStorage:d,serverHooks:y}=u;function g(){return(0,n.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:d})}},78335:()=>{},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},83997:e=>{"use strict";e.exports=require("tty")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[4447,580,5195,4612],()=>a(77274));module.exports=r})();