"use strict";(()=>{var e={};e.id=6499,e.ids=[6499],e.modules={588:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.d(r,{G7:()=>d,Qk:()=>c,db:()=>u});var a=t(9801),n=t(7879),i=t(14276),o=e([a,n,i]);[a,n,i]=o.then?(await o)():o;let l=null,d=null,c=null;!function(){try{if((0,a.getApps)().length>0){l=(0,a.getApps)().find(e=>"admin"===e.name)||(0,a.getApps)()[0],d=(0,n.getFirestore)(l),c=(0,i.getAuth)(l);return}let e=process.env.FIREBASE_ADMIN_PROJECT_ID,r=process.env.FIREBASE_ADMIN_PRIVATE_KEY,t=process.env.FIREBASE_ADMIN_CLIENT_EMAIL;if(!e||!r||!t)return void console.warn("Firebase Admin environment variables not found. Admin features will be disabled.");let s=r;s=(s=s.replace(/^["']|["']$/g,"")).replace(/\\n/g,"\n");let o={type:"service_account",project_id:e,private_key:s,client_email:t};l=(0,a.initializeApp)({credential:(0,a.cert)(o),projectId:e},"admin"),d=(0,n.getFirestore)(l),c=(0,i.getAuth)(l),console.log("Firebase Admin initialized successfully")}catch(e){console.error("Failed to initialize Firebase Admin:",e),l=null,d=null,c=null}}();let u=d;s()}catch(e){s(e)}})},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7879:e=>{e.exports=import("firebase-admin/firestore")},9801:e=>{e.exports=import("firebase-admin/app")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11739:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.d(r,{FE:()=>d,Te:()=>c,b4:()=>l,iO:()=>u});var a=t(58430),n=t(59506),i=t(588),o=e([i]);async function l(e,r){try{if(!i.db)throw Error("Firebase Admin not initialized");let t=i.db,s=await t.collection("restaurants").doc(e).get();if(!s.exists)throw Error("Restaurant not found");let o=s.data(),l=o.address.coordinates;if(!l)throw Error("Restaurant location not available");let d=(await (0,a.ft)(r)).coordinates,c=await (0,a.Rp)(l,d,o.deliveryRadius),u=(0,n.VA)(c.estimatedTime);return{...c,estimatedTime:u}}catch(e){throw console.error("Delivery calculation error:",e),e}}async function d(e){try{let r=await (0,a.E4)(e);return{isValid:r.isServiceable,coordinates:r.coordinates,formattedAddress:r.formattedAddress,reason:r.reason}}catch(e){return console.error("Address validation error:",e),{isValid:!1,reason:"Unable to validate address"}}}async function c(e,r=10){try{if(!i.db)throw Error("Firebase Admin not initialized");let t=i.db,s=await t.collection("restaurants").where("status","==","active").where("isOpen","==",!0).get(),o=[];s.forEach(e=>{o.push({id:e.id,...e.data()})});let l=o.filter(e=>e.address?.coordinates);if(0===l.length)return[];let d=l.map(e=>e.address.coordinates),c=await (0,a.HR)(e,d),u=[];for(let e=0;e<l.length;e++){let t=l[e],s=c[e];if("OK"===s.status){let e=s.distance.value/1e3;if(e<=r){let r=Math.round(s.duration.value/60),a=(0,n.Jo)(e);u.push({restaurantId:t.id,name:t.name,address:{...t.address,coordinates:t.address.coordinates},deliveryRadius:t.deliveryRadius||10,isOpen:t.isOpen,estimatedPreparationTime:t.averagePreparationTime||30,distance:e,estimatedDeliveryTime:r,deliveryFee:a})}}}return u.sort((e,r)=>e.distance-r.distance)}catch(e){return console.error("Find restaurants in radius error:",e),[]}}async function u(e,r){try{let t=await d(e);if(!t.isValid)return{isAvailable:!1,reason:t.reason||"Invalid address"};let s=t.coordinates;if(r){if(!i.db)throw Error("Firebase Admin not initialized");let e=i.db,t=await e.collection("restaurants").doc(r).get();if(!t.exists)return{isAvailable:!1,reason:"Restaurant not found"};let a=t.data(),o=a.address.coordinates;if(!o)return{isAvailable:!1,reason:"Restaurant location not available"};let l=(0,n.aO)(o,s,a.deliveryRadius||10);return{isAvailable:l,reason:l?void 0:"Outside delivery radius"}}{let e=await c(s,25);return{isAvailable:e.length>0,reason:0===e.length?"No restaurants deliver to this area":void 0,nearbyRestaurants:e.map(e=>e.restaurantId)}}}catch(e){return console.error("Delivery availability check error:",e),{isAvailable:!1,reason:"Unable to check delivery availability"}}}i=(o.then?(await o)():o)[0],s()}catch(e){s(e)}})},14276:e=>{e.exports=import("firebase-admin/auth")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},81443:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{patchFetch:()=>d,routeModule:()=>c,serverHooks:()=>f,workAsyncStorage:()=>u,workUnitAsyncStorage:()=>p});var a=t(96559),n=t(48088),i=t(37719),o=t(90007),l=e([o]);o=(l.then?(await l)():l)[0];let c=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/delivery/calculate/route",pathname:"/api/delivery/calculate",filename:"route",bundlePath:"app/api/delivery/calculate/route"},resolvedPagePath:"C:\\Users\\ACER\\Desktop\\tap2go\\apps\\web\\src\\app\\api\\delivery\\calculate\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:u,workUnitAsyncStorage:p,serverHooks:f}=c;function d(){return(0,i.patchFetch)({workAsyncStorage:u,workUnitAsyncStorage:p})}s()}catch(e){s(e)}})},90007:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{GET:()=>d,OPTIONS:()=>c,POST:()=>o,PUT:()=>l});var a=t(32190),n=t(11739),i=e([n]);async function o(e){try{let{restaurantId:r,deliveryAddress:t}=await e.json();if(!r||!t)return a.NextResponse.json({success:!1,error:"Restaurant ID and delivery address are required"},{status:400});if("string"!=typeof r||"string"!=typeof t)return a.NextResponse.json({success:!1,error:"Invalid input format"},{status:400});let s=await (0,n.b4)(r,t);return a.NextResponse.json({success:!0,data:{restaurantId:r,deliveryAddress:t,...s,currency:"PHP"},message:"Delivery information calculated successfully"},{status:200})}catch(e){if(console.error("Delivery calculation API error:",e),e instanceof Error&&"Restaurant not found"===e.message)return a.NextResponse.json({success:!1,error:"Restaurant not found"},{status:404});if(e instanceof Error&&"Restaurant location not available"===e.message)return a.NextResponse.json({success:!1,error:"Restaurant location not available"},{status:400});if(e&&"object"==typeof e&&"code"in e)return a.NextResponse.json({success:!1,error:e.message,details:e.details},{status:"NOT_FOUND"===e.code?404:"INVALID_REQUEST"===e.code?400:500});return a.NextResponse.json({success:!1,error:"Internal server error during delivery calculation"},{status:500})}}async function l(e){try{let{address:r,restaurantId:t}=await e.json();if(!r)return a.NextResponse.json({success:!1,error:"Address is required"},{status:400});if("string"!=typeof r)return a.NextResponse.json({success:!1,error:"Address must be a string"},{status:400});let s=await (0,n.FE)(r);if(!s.isValid)return a.NextResponse.json({success:!1,error:s.reason||"Invalid address",data:s},{status:400});let i=null;return t&&(i=await (0,n.iO)(r,t)),a.NextResponse.json({success:!0,data:{addressValidation:s,deliveryAvailability:i},message:"Address validated successfully"},{status:200})}catch(e){if(console.error("Address validation API error:",e),e&&"object"==typeof e&&"code"in e)return a.NextResponse.json({success:!1,error:e.message,details:e.details},{status:"NOT_FOUND"===e.code?404:"INVALID_REQUEST"===e.code?400:500});return a.NextResponse.json({success:!1,error:"Internal server error during address validation"},{status:500})}}async function d(e){try{let{searchParams:r}=new URL(e.url),t=r.get("lat"),s=r.get("lng"),i=r.get("radius");if(!t||!s)return a.NextResponse.json({success:!1,error:"Latitude and longitude are required"},{status:400});let o=parseFloat(t),l=parseFloat(s);if(isNaN(o)||isNaN(l))return a.NextResponse.json({success:!1,error:"Invalid coordinate format"},{status:400});if(o<-90||o>90||l<-180||l>180)return a.NextResponse.json({success:!1,error:"Coordinates out of valid range"},{status:400});let d=i?parseFloat(i):10;if(isNaN(d)||d<=0||d>50)return a.NextResponse.json({success:!1,error:"Radius must be a positive number between 0 and 50 km"},{status:400});let c={lat:o,lng:l},u=await (0,n.Te)(c,d);return a.NextResponse.json({success:!0,data:{customerLocation:c,radius:d,restaurants:u,count:u.length},message:`Found ${u.length} restaurants within ${d}km`},{status:200})}catch(e){if(console.error("Nearby restaurants API error:",e),e&&"object"==typeof e&&"code"in e)return a.NextResponse.json({success:!1,error:e.message,details:e.details},{status:"NOT_FOUND"===e.code?404:"INVALID_REQUEST"===e.code?400:500});return a.NextResponse.json({success:!1,error:"Internal server error while finding nearby restaurants"},{status:500})}}async function c(){return new a.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}n=(i.then?(await i)():i)[0],s()}catch(e){s(e)}})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4447,580,6770],()=>t(81443));module.exports=s})();