(()=>{var e={};e.id=9445,e.ids=[8010,9445],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},8010:(e,t,r)=>{"use strict";r.d(t,{db:()=>p});var s=r(89579),a=r(50784),n=r(58328),o=r(71818);r(18578);let i={apiKey:"AIzaSyB6ALvnN6aX0DMVhePhkUow9VrPauBCqgQ",authDomain:"tap2go-kuucn.firebaseapp.com",projectId:"tap2go-kuucn",storageBucket:"tap2go-kuucn.firebasestorage.app",messagingSenderId:"828629511294",appId:"1:828629511294:web:fae32760ca3c3afcb87c2f"},c=Object.entries(i).filter(([,e])=>!e).map(([e])=>e);if(c.length>0)throw Error(`Missing Firebase environment variables: ${c.join(", ")}`);let u={apiKey:i.apiKey,authDomain:i.authDomain,projectId:i.projectId,storageBucket:i.storageBucket,messagingSenderId:i.messagingSenderId,appId:i.appId},l=(0,s.Wp)(u);(0,a.xI)(l);let p=(0,n.aU)(l);(0,o.c7)(l)},8332:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>_,routeModule:()=>I,serverHooks:()=>D,workAsyncStorage:()=>k,workUnitAsyncStorage:()=>v});var s={};r.r(s),r.d(s,{GET:()=>x,POST:()=>w});var a=r(96559),n=r(48088),o=r(37719),i=r(32190),c=r(8010),u=r(58328);let l=async e=>{try{await (0,u.gS)((0,u.collection)(c.db,"search_analytics"),{...e,timestamp:new Date})}catch(e){console.error("Error tracking search event:",e)}},p=async()=>{try{let e=new Date;e.setDate(e.getDate()-30);let t=(0,u.P)((0,u.collection)(c.db,"search_analytics"),(0,u._M)("timestamp",">=",e),(0,u._M)("results",">",0),(0,u.My)("timestamp","desc"),(0,u.AB)(1e3)),r=await (0,u.getDocs)(t),s={};return r.docs.forEach(e=>{let t=e.data().query.toLowerCase().trim();s[t]=(s[t]||0)+1}),Object.entries(s).sort(([,e],[,t])=>t-e).slice(0,10).map(([e])=>e)}catch(e){return console.error("Error getting learned popular queries:",e),["Pizza","Burger","Chinese","Italian"]}},d=async()=>{try{let e=new Date;e.setDate(e.getDate()-7);let t=(0,u.P)((0,u.collection)(c.db,"search_analytics"),(0,u._M)("timestamp",">=",e),(0,u._M)("results","==",0),(0,u.AB)(500)),r=await (0,u.getDocs)(t),s={};r.docs.forEach(e=>{let t=e.data().query.toLowerCase().trim();s[t]=(s[t]||0)+1});let a={};for(let[e,t]of Object.entries(s))if(t>=3){let t=await g(e);t.length>0&&(a[e]=t)}return a}catch(e){return console.error("Error learning from failed queries:",e),{}}},g=async e=>{try{let t=new Date;t.setDate(t.getDate()-30);let r=(0,u.P)((0,u.collection)(c.db,"search_analytics"),(0,u._M)("timestamp",">=",t),(0,u._M)("results",">",0),(0,u.AB)(1e3)),s=await (0,u.getDocs)(r),a=[];s.docs.forEach(e=>{let t=e.data();a.push(t.query.toLowerCase().trim())});let n=a.filter(t=>{let r=h(e,t);return r<=2&&r>0});return[...new Set(n)].slice(0,3)}catch(e){return console.error("Error finding similar queries:",e),[]}},h=(e,t)=>{let r=Array(t.length+1).fill(null).map(()=>Array(e.length+1).fill(null));for(let t=0;t<=e.length;t++)r[0][t]=t;for(let e=0;e<=t.length;e++)r[e][0]=e;for(let s=1;s<=t.length;s++)for(let a=1;a<=e.length;a++){let n=+(e[a-1]!==t[s-1]);r[s][a]=Math.min(r[s][a-1]+1,r[s-1][a]+1,r[s-1][a-1]+n)}return r[t.length][e.length]},m=async e=>{try{let t=new Date;t.setDate(t.getDate()-30);let r=(0,u.P)((0,u.collection)(c.db,"search_analytics"),(0,u._M)("userId","==",e),(0,u._M)("timestamp",">=",t),(0,u._M)("results",">",0),(0,u.My)("timestamp","desc"),(0,u.AB)(100)),s=await (0,u.getDocs)(r),a={};return s.docs.forEach(e=>{let t=e.data().query.toLowerCase().trim();a[t]=(a[t]||0)+1}),Object.entries(a).sort(([,e],[,t])=>t-e).slice(0,5).map(([e])=>e)}catch(e){return console.error("Error getting user search patterns:",e),[]}},y=async(e,t)=>{try{let[r,s,a]=await Promise.all([p(),d(),t?m(t):Promise.resolve([])]),n=s[e.toLowerCase()]||[],o=r.filter(t=>t.toLowerCase().includes(e.toLowerCase())||e.toLowerCase().includes(t.toLowerCase())),i=a.filter(t=>t.toLowerCase().includes(e.toLowerCase())),c=[...n,...i,...o];return[...new Set(c)].slice(0,8)}catch(e){return console.error("Error getting learned suggestions:",e),[]}};async function w(e){try{let{action:t,...r}=await e.json();switch(t){case"track_search":return await f(r),i.NextResponse.json({success:!0,message:"Search event tracked"});case"track_click":return await q(r),i.NextResponse.json({success:!0,message:"Click event tracked"});default:return i.NextResponse.json({success:!1,error:"Invalid action"},{status:400})}}catch(e){return console.error("Learning API error:",e),i.NextResponse.json({success:!1,error:"Failed to process learning event"},{status:500})}}async function x(e){try{let{searchParams:t}=new URL(e.url),r=t.get("type"),s=t.get("q"),a=t.get("userId");switch(r){case"suggestions":if(!s)return i.NextResponse.json({success:!1,error:"Query parameter required for suggestions"},{status:400});let n=await y(s,a||void 0);return i.NextResponse.json({success:!0,data:{suggestions:n,type:"learned",query:s}});case"popular":let o=await p();return i.NextResponse.json({success:!0,data:{queries:o,type:"popular_learned"}});case"failed":let c=await d();return i.NextResponse.json({success:!0,data:{synonyms:c,type:"failed_learning"}});case"user_patterns":if(!a)return i.NextResponse.json({success:!1,error:"userId parameter required for user patterns"},{status:400});let u=await m(a);return i.NextResponse.json({success:!0,data:{patterns:u,type:"user_patterns"}});case"analytics":let[l,g,h]=await Promise.all([p(),d(),a?m(a):Promise.resolve([])]);return i.NextResponse.json({success:!0,data:{analytics:{popularQueries:l,learnedSynonyms:g,userPatterns:h,totalLearnings:Object.keys(g).length}}});default:return i.NextResponse.json({success:!1,error:"Invalid type parameter"},{status:400})}}catch(e){return console.error("Learning insights API error:",e),i.NextResponse.json({success:!1,error:"Failed to get learning insights"},{status:500})}}async function f(e){let t={query:e.query,results:e.results||0,userId:e.userId,timestamp:new Date,sessionId:e.sessionId||j()};await l(t)}async function q(e){let t={query:e.query,results:e.totalResults||0,clickedResult:e.clickedResult,resultPosition:e.position,userId:e.userId,timestamp:new Date,sessionId:e.sessionId||j()};await l(t)}function j(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}let I=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/search/learn/route",pathname:"/api/search/learn",filename:"route",bundlePath:"app/api/search/learn/route"},resolvedPagePath:"C:\\Users\\ACER\\Desktop\\tap2go\\apps\\web\\src\\app\\api\\search\\learn\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:k,workUnitAsyncStorage:v,serverHooks:D}=I;function _(){return(0,o.patchFetch)({workAsyncStorage:k,workUnitAsyncStorage:v})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14985:e=>{"use strict";e.exports=require("dns")},19771:e=>{"use strict";e.exports=require("process")},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73496:e=>{"use strict";e.exports=require("http2")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4447,580,8328,1054],()=>r(8332));module.exports=s})();