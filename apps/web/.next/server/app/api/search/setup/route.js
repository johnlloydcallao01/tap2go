(()=>{var e={};e.id=5560,e.ids=[5560,8010],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7923:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>O,routeModule:()=>h,serverHooks:()=>R,workAsyncStorage:()=>A,workUnitAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{GET:()=>f,POST:()=>m});var a=r(96559),i=r(48088),n=r(37719),o=r(32190),c=r(93353),u=r(22022);let d=e=>({id:e.id,name:e.name,description:e.description,cuisine:Array.isArray(e.cuisine)?e.cuisine:[e.cuisine],rating:e.rating||0,reviewCount:e.reviewCount||0,deliveryTime:e.deliveryTime,deliveryFee:e.deliveryFee||0,minimumOrder:e.minimumOrder||0,isOpen:e.isOpen??!0,featured:e.featured??!1,location:e.address?.coordinates?{lat:e.address.coordinates.lat,lon:e.address.coordinates.lng}:null,address:{street:e.address?.street||"",city:e.address?.city||"",state:e.address?.state||"",zipCode:e.address?.zipCode||"",country:e.address?.country||"Philippines"},operatingHours:e.openingHours||{},createdAt:e.createdAt instanceof Date?e.createdAt.toISOString():"object"==typeof e.createdAt&&e.createdAt&&"toDate"in e.createdAt?e.createdAt.toDate().toISOString():new Date().toISOString(),updatedAt:e.updatedAt instanceof Date?e.updatedAt.toISOString():"object"==typeof e.updatedAt&&e.updatedAt&&"toDate"in e.updatedAt?e.updatedAt.toDate().toISOString():new Date().toISOString(),suggest:{input:[e.name,...Array.isArray(e.cuisine)?e.cuisine:[e.cuisine]].filter(Boolean)}}),p=async()=>{try{console.log("\uD83D\uDD04 Starting bulk sync from Firestore to Bonsai..."),await (0,c.GR)();let{collection:e,getDocs:t}=await Promise.resolve().then(r.bind(r,58328)),{db:s}=await Promise.resolve().then(r.bind(r,8010)),a=(await t(e(s,"restaurants"))).docs.map(e=>{let t=e.data();return{id:e.id,name:t.outletName||t.name||"",description:t.description||"",image:t.coverImageUrl||t.image||"",coverImage:t.coverImageUrl||t.image||"",cuisine:t.cuisineTags||t.cuisine||[],address:t.address||{},phone:t.outletPhone||t.phone||"",email:t.email||"",ownerId:t.vendorRef||t.ownerId||"",rating:t.avgRating||t.rating||0,reviewCount:t.totalReviews||t.reviewCount||0,deliveryTime:t.estimatedDeliveryRange||t.deliveryTime||"N/A",deliveryFee:t.deliveryFees?.base||t.deliveryFee||0,minimumOrder:t.minimumOrderValue||t.minimumOrder||0,isOpen:t.isOpen??!0,featured:t.featured??!1,openingHours:t.operatingHours||t.openingHours||{},status:t.status||"active",commissionRate:t.commissionRate||0,totalOrders:t.totalOrders||0,averageOrderValue:t.averageOrderValue||0,totalRevenue:t.totalRevenue||0,averagePreparationTime:t.averagePreparationTime||30,createdAt:t.createdAt?.toDate?.()||t.createdAt||new Date,updatedAt:t.updatedAt?.toDate?.()||t.updatedAt||new Date}});if(console.log(`📊 Found ${a.length} restaurants in Firestore`),0===a.length)return console.log("ℹ️ No restaurants found in Firestore"),{success:0,failed:0,total:0};let i=[];a.forEach(e=>{let t=d(e);i.push({index:{_index:c.Wr.RESTAURANTS,_id:e.id}}),i.push(t)}),console.log("\uD83D\uDCE4 Executing bulk index operation...");let n=await c.IN.bulk({body:i,refresh:!0}),o=0,u=0;return n.body.items&&n.body.items.forEach(e=>{e.index&&e.index.error?(u++,console.error("❌ Bulk index error:",e.index.error)):o++}),console.log(`✅ Bulk sync completed: ${o} success, ${u} failed`),{success:o,failed:u,total:a.length}}catch(e){throw console.error("❌ Bulk sync failed:",e),e}},l=async()=>{try{let{restaurants:e}=await (0,u.xk)(1),t=e.length,r=(await c.IN.count({index:c.Wr.RESTAURANTS})).body.count,s=1>=Math.abs(t-r);return{firestoreCount:t,bonsaiCount:r,inSync:s}}catch(e){throw console.error("Error checking sync status:",e),e}};async function m(e){try{let{action:t}=await e.json();switch(t){case"test-connection":return await g();case"initialize":return await y();case"sync-data":return await v();case"check-status":return await w();default:return o.NextResponse.json({success:!1,error:"Invalid action",message:"Valid actions: test-connection, initialize, sync-data, check-status"},{status:400})}}catch(e){return console.error("Setup API error:",e),o.NextResponse.json({success:!1,error:"Setup failed",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function g(){try{if(!await (0,c.V3)())return o.NextResponse.json({success:!1,message:"Bonsai connection failed",data:{connected:!1}});{let e=await (0,c.HX)();return o.NextResponse.json({success:!0,message:"Bonsai connection successful",data:{connected:!0,cluster:e}})}}catch(e){return o.NextResponse.json({success:!1,error:"Connection test failed",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function y(){try{if(!await (0,c.V3)())throw Error("Cannot connect to Bonsai cluster");return await (0,c.GR)(),o.NextResponse.json({success:!0,message:"Bonsai indices initialized successfully",data:{indices:["tap2go_restaurants"],status:"ready"}})}catch(e){return o.NextResponse.json({success:!1,error:"Initialization failed",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function v(){try{if(!await (0,c.V3)())throw Error("Cannot connect to Bonsai cluster");await (0,c.GR)();let e=await p();return o.NextResponse.json({success:!0,message:"Data sync completed",data:{syncResult:e,status:0===e.failed?"success":"partial"}})}catch(e){return o.NextResponse.json({success:!1,error:"Data sync failed",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function w(){try{let e=await l();return o.NextResponse.json({success:!0,message:"Status check completed",data:{firestore:{count:e.firestoreCount,source:"Firestore database"},bonsai:{count:e.bonsaiCount,source:"Bonsai search index"},sync:{inSync:e.inSync,status:e.inSync?"synchronized":"out-of-sync"}}})}catch(e){return o.NextResponse.json({success:!1,error:"Status check failed",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function f(){try{let e=await (0,c.V3)();return o.NextResponse.json({success:!0,data:{service:"Bonsai Elasticsearch",status:e?"connected":"disconnected",endpoints:{setup:"POST /api/search/setup",search:"GET /api/search/restaurants",suggestions:"GET /api/search/suggestions"}}})}catch(e){return o.NextResponse.json({success:!1,error:"Service check failed",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/search/setup/route",pathname:"/api/search/setup",filename:"route",bundlePath:"app/api/search/setup/route"},resolvedPagePath:"C:\\Users\\ACER\\Desktop\\tap2go\\apps\\web\\src\\app\\api\\search\\setup\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:A,workUnitAsyncStorage:x,serverHooks:R}=h;function O(){return(0,n.patchFetch)({workAsyncStorage:A,workUnitAsyncStorage:x})}},8010:(e,t,r)=>{"use strict";r.d(t,{db:()=>p});var s=r(89579),a=r(50784),i=r(58328),n=r(71818);r(18578);let o={apiKey:"AIzaSyB6ALvnN6aX0DMVhePhkUow9VrPauBCqgQ",authDomain:"tap2go-kuucn.firebaseapp.com",projectId:"tap2go-kuucn",storageBucket:"tap2go-kuucn.firebasestorage.app",messagingSenderId:"828629511294",appId:"1:828629511294:web:fae32760ca3c3afcb87c2f"},c=Object.entries(o).filter(([,e])=>!e).map(([e])=>e);if(c.length>0)throw Error(`Missing Firebase environment variables: ${c.join(", ")}`);let u={apiKey:o.apiKey,authDomain:o.authDomain,projectId:o.projectId,storageBucket:o.storageBucket,messagingSenderId:o.messagingSenderId,appId:o.appId},d=(0,s.Wp)(u);(0,a.xI)(d);let p=(0,i.aU)(d);(0,n.c7)(d)},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{"use strict";e.exports=require("querystring")},12412:e=>{"use strict";e.exports=require("assert")},14985:e=>{"use strict";e.exports=require("dns")},19771:e=>{"use strict";e.exports=require("process")},21820:e=>{"use strict";e.exports=require("os")},22022:(e,t,r)=>{"use strict";r.d(t,{Ou:()=>n,Vh:()=>u,g2:()=>o,re:()=>c,xk:()=>i});var s=r(58328),a=r(8010);let i=async(e=20,t)=>{let r=(0,s.P)((0,s.collection)(a.db,"restaurants"),(0,s.My)("featured","desc"),(0,s.My)("rating","desc"),(0,s.AB)(e));t&&(r=(0,s.P)(r,(0,s.HM)(t)));let i=await (0,s.getDocs)(r);return{restaurants:i.docs.map(e=>{let t=e.data();return{id:e.id,name:t.outletName||t.name||"",description:t.description||"",image:t.coverImageUrl||t.image||"",coverImage:t.coverImageUrl||t.image||"",cuisine:t.cuisineTags||t.cuisine||[],address:t.address||{},phone:t.outletPhone||t.phone||"",email:t.email||"",ownerId:t.vendorRef||t.ownerId||"",rating:t.avgRating||t.rating||0,reviewCount:t.totalReviews||t.reviewCount||0,deliveryTime:t.estimatedDeliveryRange||t.deliveryTime||"N/A",deliveryFee:t.deliveryFees?.base||t.deliveryFee||0,minimumOrder:t.minOrderValue||t.minimumOrder||0,isOpen:void 0!==t.isAcceptingOrders?t.isAcceptingOrders:void 0===t.isOpen||t.isOpen,openingHours:t.operatingHours||t.openingHours||{},featured:t.featured||!1,status:t.platformStatus||t.status||"active",commissionRate:t.commissionRate||15,totalOrders:t.totalOrders||0,totalRevenue:t.totalRevenue||0,averagePreparationTime:t.preparationTime?.average||t.averagePreparationTime||20,createdAt:t.createdAt?.toDate?.()||new Date,updatedAt:t.updatedAt?.toDate?.()||new Date}}),lastDoc:i.docs[i.docs.length-1],hasMore:i.docs.length===e}},n=async e=>{let t=(0,s.H9)(a.db,"restaurants",e),r=await (0,s.x7)(t);if(r.exists()){let e=r.data();return{id:r.id,name:e.outletName||e.name||"",description:e.description||"",image:e.coverImageUrl||e.image||"",coverImage:e.coverImageUrl||e.image||"",cuisine:e.cuisineTags||e.cuisine||[],address:e.address||{},phone:e.outletPhone||e.phone||"",email:e.email||"",ownerId:e.vendorRef||e.ownerId||"",rating:e.avgRating||e.rating||0,reviewCount:e.totalReviews||e.reviewCount||0,deliveryTime:e.estimatedDeliveryRange||e.deliveryTime||"N/A",deliveryFee:e.deliveryFees?.base||e.deliveryFee||0,minimumOrder:e.minOrderValue||e.minimumOrder||0,isOpen:void 0!==e.isAcceptingOrders?e.isAcceptingOrders:void 0===e.isOpen||e.isOpen,openingHours:e.operatingHours||e.openingHours||{},featured:e.featured||!1,status:e.platformStatus||e.status||"active",commissionRate:e.commissionRate||15,totalOrders:e.totalOrders||0,totalRevenue:e.totalRevenue||0,averagePreparationTime:e.preparationTime?.average||e.averagePreparationTime||20,createdAt:e.createdAt?.toDate?.()||new Date,updatedAt:e.updatedAt?.toDate?.()||new Date}}return null},o=async e=>(await (0,s.gS)((0,s.collection)(a.db,"restaurants"),{...e,createdAt:new Date,updatedAt:new Date})).id,c=async(e,t)=>{let r=(0,s.H9)(a.db,"restaurants",e);await (0,s.mZ)(r,{...t,updatedAt:new Date})},u=async(e,t)=>{let r=(0,s.P)((0,s.collection)(a.db,"restaurants"));t&&(r=(0,s.P)(r,(0,s._M)("cuisine","array-contains",t)));let i=(await (0,s.getDocs)(r)).docs.map(e=>{let t=e.data();return{id:e.id,name:t.outletName||t.name||"",description:t.description||"",image:t.coverImageUrl||t.image||"",coverImage:t.coverImageUrl||t.image||"",cuisine:t.cuisineTags||t.cuisine||[],address:t.address||{},phone:t.outletPhone||t.phone||"",email:t.email||"",ownerId:t.vendorRef||t.ownerId||"",rating:t.avgRating||t.rating||0,reviewCount:t.totalReviews||t.reviewCount||0,deliveryTime:t.estimatedDeliveryRange||t.deliveryTime||"N/A",deliveryFee:t.deliveryFees?.base||t.deliveryFee||0,minimumOrder:t.minOrderValue||t.minimumOrder||0,isOpen:void 0!==t.isAcceptingOrders?t.isAcceptingOrders:void 0===t.isOpen||t.isOpen,openingHours:t.operatingHours||t.openingHours||{},featured:t.featured||!1,status:t.platformStatus||t.status||"active",commissionRate:t.commissionRate||15,totalOrders:t.totalOrders||0,totalRevenue:t.totalRevenue||0,averagePreparationTime:t.preparationTime?.average||t.averagePreparationTime||20,createdAt:t.createdAt?.toDate?.()||new Date,updatedAt:t.updatedAt?.toDate?.()||new Date}});return e?i.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())||t.description.toLowerCase().includes(e.toLowerCase())||t.cuisine.some(t=>t.toLowerCase().includes(e.toLowerCase()))):i}},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73496:e=>{"use strict";e.exports=require("http2")},74075:e=>{"use strict";e.exports=require("zlib")},77824:e=>{"use strict";e.exports=require("v8")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},83997:e=>{"use strict";e.exports=require("tty")},91645:e=>{"use strict";e.exports=require("net")},93353:(e,t,r)=>{"use strict";r.d(t,{GR:()=>m,HX:()=>d,IN:()=>c,V3:()=>u,Wr:()=>p});var s=r(47458);let a=process.env.BONSAI_HOST,i=process.env.BONSAI_USERNAME,n=process.env.BONSAI_PASSWORD,o=process.env.BONSAI_URL;if(!a&&!o)throw Error("Missing Bonsai configuration. Please set BONSAI_HOST + credentials or BONSAI_URL in .env.local");let c=new s.Kj({...a&&{node:a,auth:{username:i,password:n}},...o&&!a&&{node:o},requestTimeout:3e4,pingTimeout:3e3,maxRetries:3,ssl:{rejectUnauthorized:!0}}),u=async()=>{try{return await c.ping(),console.log("✅ Bonsai Elasticsearch connection successful"),!0}catch(e){return console.error("❌ Bonsai Elasticsearch connection failed:",e),!1}},d=async()=>{try{let e=await c.info();return console.log("\uD83D\uDCCA Bonsai Cluster Info:",{name:e.body.cluster_name,version:e.body.version.number,lucene_version:e.body.version.lucene_version}),e.body}catch(e){throw console.error("Error getting cluster info:",e),e}},p={RESTAURANTS:"tap2go_restaurants",MENU_ITEMS:"tap2go_menu_items",CATEGORIES:"tap2go_categories",REVIEWS:"tap2go_reviews"},l={settings:{number_of_shards:1,number_of_replicas:0,analysis:{analyzer:{restaurant_analyzer:{type:"custom",tokenizer:"standard",filter:["lowercase","asciifolding","stop"]}}}},mappings:{properties:{id:{type:"keyword"},name:{type:"text",analyzer:"restaurant_analyzer",fields:{keyword:{type:"keyword"},suggest:{type:"completion"}}},description:{type:"text",analyzer:"restaurant_analyzer"},cuisine:{type:"keyword"},rating:{type:"float"},reviewCount:{type:"integer"},deliveryTime:{type:"keyword"},deliveryFee:{type:"float"},minimumOrder:{type:"float"},isOpen:{type:"boolean"},featured:{type:"boolean"},location:{type:"geo_point"},address:{type:"object",properties:{street:{type:"text"},city:{type:"keyword"},state:{type:"keyword"},zipCode:{type:"keyword"},country:{type:"keyword"}}},operatingHours:{type:"object",properties:{monday:{type:"object"},tuesday:{type:"object"},wednesday:{type:"object"},thursday:{type:"object"},friday:{type:"object"},saturday:{type:"object"},sunday:{type:"object"}}},createdAt:{type:"date"},updatedAt:{type:"date"}}}},m=async()=>{try{return(await c.indices.exists({index:p.RESTAURANTS})).body?console.log("✅ Restaurants index already exists"):(console.log("Creating restaurants index..."),await c.indices.create({index:p.RESTAURANTS,body:l}),console.log("✅ Restaurants index created")),!0}catch(e){throw console.error("Error initializing indices:",e),e}}},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4447,580,5195,8328,1054,7458],()=>r(7923));module.exports=s})();